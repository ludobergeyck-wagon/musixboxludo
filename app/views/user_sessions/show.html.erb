<% questions=Question.where(session_id: @user_session.session_id).order(:id) %>
  <% total_questions=questions.count %>
    <% current_index=questions.find_index { |q| q.id==@current_question.id }.to_i + 1 %>
    <div class="container-100 d-flex flex-column justify-content-between position-relative" data-controller="lobby"
  data-lobby-user-id-value="<%= current_or_guest_user.id %>"
  data-lobby-group-id-value="<%= @user_session.group.id %>"
  data-lobby-start-url-value="<%= play_session_path(@user_session) %>"
  data-lobby-session-path-value="<%= play_session_path(@user_session) %>"
  data-lobby-is-host-value="<%= @user_session.group.host_id == current_or_guest_user.id %>">
        <div class="bg-show" data-controller="audio toggle">
          <!-- Video STICKY avec progress bar et feedback PAR-DESSUS -->
          <div class="video-sticky position-relative">
            <!-- Progress bar SUR la vidéo -->
            <div id="progress_bar">
              <div class="d-flex gap-1 mb-1">
                <% (1..total_questions).each do |i| %>
                  <div class="progress-brutal flex-grow-1">
                    <% if i <=current_index %>
                      <div class="progress-brutal-fill"></div>
                      <% else %>
                        <div class="progress-brutal-empty"></div>
                        <% end %>
                  </div>
                  <% end %>
              </div>
            </div>
            <!-- Feedback SUR la vidéo -->
            <turbo-frame id="feedback_content">
            </turbo-frame>
            <!-- Video -->
            <%= turbo_frame_tag "question" do %>
              <%= render "questions/video" , question: @current_question %>
                <% end %>
          </div>
          <!-- Contenu principal - Buzzer centré -->
         <div class="content-main d-flex flex-column align-items-center justify-content-center flex-grow-1" 
          data-controller="counter" 
          data-action="counter:timeup->toggle#disableBuzzer">
            <!-- Buzzer Platine avec Vinyl intégré -->
            <div class="d-flex justify-content-center align-items-center flex-column w-100">
              <%= link_to "#" , data: { action: "click->toggle#buzz click->lobby#buzzerPressed click->lobby#pauseVideo"
                } do %>
                <div class="buzzer-platine" data-toggle-target="buzzer" data-audio-target="buzzer">
                  <!-- Vinyl qui tourne sur la platine -->
                  <div class="vinyl" data-audio-target="visualizer">
                    <div class="vinyl-grooves"></div>
                    <div class="vinyl-label">
                      <%= image_tag "Logo_sans_nom_2.png", class: "vinyl-logo" %>
                    </div>
                  </div>
                  <!-- Texte BUZZ -->
                  <span class="buzzer-text">BUZZ!</span>
                </div>
              <% end %>
              <!-- Timer visible - décompte de 30 secondes -->
              <div class="timer-display" data-counter-target="display" data-toggle-target="timer">0:30</div>
              <% if UserSession.where(group: @user_session.group).count > 1 %>
                <h2 id="buzzer-message" class="d-none text-center">Waiting for response...</h2>
              <% end %>

              <!-- Form -->
              <div class="w-100" style="max-width: 320px;">
                <div data-toggle-target="form" class="d-none text-center py-3">
                  <h2 class="form-title mb-3">Take your guess!</h2>
                  <%= simple_form_for @current_question, data: {
                    action: "submit->counter#saveTime turbo:submit-end->toggle#submitted" } do |f| %>
                    <%= f.hidden_field :time_taken, data: { counter_target: "input" } %>
                    <div class="mb-2">
                      <%= f.input :user_answer_artist, placeholder: "Artist" , label: false, input_html: {
                        class: "form-input" } %>
                    </div>
                    <div class="mb-3">
                      <%= f.input :user_answer_title, placeholder: "Title" , label: false, input_html: {
                        class: "form-input" } %>
                    </div>
                    <%= f.submit "Go!" , class: "btn-go" %>
                  <% end %>
                </div>
              </div>
              <!-- Well done -->
              <div class="d-none d-flex justify-content-center align-items-center py-3"
                data-toggle-target="welldone">
                <%= image_tag "thumbsup.png" , class: "welldone-img" %>
              </div>
            </div>
          </div>
          <!-- Next button - Fixé en bas -->
          <div class="position-fixed bottom-0 start-0 end-0 p-3 bg-transparent">
            <div class="d-flex justify-content-center">
              <div class="w-100" style="max-width: 320px;">
                <%= link_to play_session_path(@user_session, current_question: @current_question),
                  class: "btn-next d-block w-100 py-3 rounded-3 text-center text-decoration-none",
                  data: { action: "click->lobby#goToNext" } do %>
                  Next →
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
