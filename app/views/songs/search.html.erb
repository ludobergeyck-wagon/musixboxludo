<div class="vh-100 d-flex flex-column px-3" style="padding-top: 80px; padding-bottom: 20px;">
  <div class="container d-flex flex-column h-100" style="max-width: 500px;">

    <!-- Header (fixe) -->
    <div class="text-center mb-3 flex-shrink-0">
      <h1 class="fw-bold">üîç Search results</h1>
      <% if params[:query].present? || params.dig(:search, :query).present? %>
        <p class="text-muted">Results for "<%= params[:query] || params.dig(:search, :query) %>"</p>
      <% end %>
    </div>

    <!-- Formulaire recherche (fixe) -->
    <div class="card border-dark border-2 mb-3 shadow-sm flex-shrink-0">
      <div class="card-body p-3">
        <%= simple_form_for :search, url: search_songs_path, method: :get do |f| %>
          <%= f.hidden_field :playlist_id, value: @playlist&.id %>
          <div class="input-group">
            <%= f.input_field :query, class: "form-control border-dark border-2", placeholder: "Search artist or song...", value: params[:query] || params.dig(:search, :query) %>
            <%= f.submit "Search", class: "btn btn-warning border-dark border-2 fw-bold" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- R√©sultats (scrollable) -->
    <div class="card border-dark border-2 shadow-sm flex-grow-1 d-flex flex-column overflow-hidden">
      <div class="card-header bg-light border-dark flex-shrink-0">
        <h5 class="fw-bold mb-0">üéµ Songs found (<%= @songs.count %>)</h5>
      </div>
      <div class="card-body p-0 overflow-auto">
        <% if @songs.any? %>
          <ul class="list-group list-group-flush">
            <% @songs.each do |song| %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-bold"><%= song[:title] %></div>
                  <small class="text-muted"><%= song[:artist] %></small>
                </div>
               <% if @playlist %>
                    <% existing_song = @playlist.songs.find_by(title: song[:title], artist: song[:artist]) %>
                        <% if existing_song %>
                            <span class="btn btn-secondary btn-sm border-dark disabled">‚úì</span>
                <% else %>
                     <%= button_to playlist_songs_path(@playlist), method: :post, class: "btn btn-success btn-sm border-dark", params: { song: { title: song[:title], artist: song[:artist], preview_url: song[:preview_url], year: song[:year] }, query: params[:query] || params.dig(:search, :query) } do %>
                         ‚ûï
                        <% end %>
                    <% end %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="text-center text-muted py-4">
            <p class="fs-1 mb-2">üòï</p>
            <p>No songs found. Try another search!</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Back link (fixe) -->
    <div class="text-center mt-3 flex-shrink-0">
      <% if @playlist %>
        <%= link_to "‚Üê Back to playlist", playlist_path(@playlist), class: "btn btn-outline-dark fw-bold" %>
      <% else %>
        <%= link_to "‚Üê Back to My Playlists", my_playlists_path, class: "btn btn-outline-dark fw-bold" %>
      <% end %>
    </div>

  </div>
</div>
