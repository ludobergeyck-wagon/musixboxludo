<div class="card-result text-center mt-5" style="position: relative; width: 100%; margin-bottom: 0;">
  <!-- Image de fond -->
  <img src="<%= asset_path('and_the_winner_is.png') %>" alt="photos" style="width: 100%; display: block; opacity: 0.7;">

  <!-- Ta photo prise (remplace le fond) -->
  <img id="userPhoto" data-camera-target="cardPhoto" alt="Votre photo"
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; display: none; border-radius: 8px;">

  <!-- Texte et overlay avec TES STATS -->
  <div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; color: #000; font-weight: bold; background: linear-gradient(to top, rgba(255, 200, 100, 0.8), rgba(255, 200, 100, 0));">

    <!-- affichage des stats -->

    <% if @percentage > 80 %>
      <div class="border border-warning border-4 rounded-4 py-2 bg-warning-subtle w-100 mx-auto">
        <h3 class="text-center text-warning fw-bolder display-8 mb-1">üèÜ Ace of <%= @playlist.title %> üèÜ</h3>

        <%# Affiche "Perfect score!" seulement si 100% %>
        <% if @percentage == 100 %>
          <p class="text-warning fw-bold fs-5 mb-0">Perfect score!</p>
        <% end %>
      </div>
    <% end %>


    <% if @fastest_title %>
    <div class="mt-3">
      <h5 class="fs-6"">üéØ fastest guess : </h5>
      <p class="fs-6">
        <%= (@fastest_title.time_taken / 1000.0).round(2) %> sec
        <% if @fastest_title.song %>
          - <%= @fastest_title.song.title %>
        <% end %>
      </p>
    </div>
    <% end %>


<div class="mt-3 d-flex justify-content-between align-items-center">
  <span class="small">üé∏ MusixBox</span>
  <span class="small text-muted">musixbox.com</span>
</div>

  </div>
<%# ============================================ %>
<%# SCRIPT : Charger la photo depuis localStorage %>
<%# ============================================ %>
<script>
  // Fonction qui charge la photo
  function loadUserPhoto() {
    console.log("Script de chargement photo ex√©cut√© !")

    // On r√©cup√®re la photo depuis localStorage
    const savedPhoto = localStorage.getItem("userSelfie")

    console.log("Photo trouv√©e:", savedPhoto ? "OUI" : "NON")

    // On r√©cup√®re les √©l√©ments HTML
    const userPhotoElement = document.getElementById("userPhoto")
    const backgroundImage = document.querySelector(".card-result > img:first-child")

    console.log("Element userPhoto:", userPhotoElement ? "OUI" : "NON")
    console.log("Element background:", backgroundImage ? "OUI" : "NON")

    // Si une photo existe dans localStorage
    if (savedPhoto && userPhotoElement) {

      // On met la photo sauvegard√©e dans l'√©l√©ment <img>
      userPhotoElement.src = savedPhoto

      // On affiche la photo de l'utilisateur
      userPhotoElement.style.display = "block"

      // On cache l'image de fond
      if (backgroundImage) {
        backgroundImage.style.opacity = "0"
      }

      console.log("Photo charg√©e avec succ√®s !")

    } else {
      console.log("Pas de photo ou √©l√©ment non trouv√©")
    }
  }

  // ============================================
  // IMPORTANT : √âcouter les DEUX √©v√©nements
  // ============================================
  // "DOMContentLoaded" = premier chargement de la page
  // "turbo:load" = navigation avec Turbo (Rails 7)

  document.addEventListener("DOMContentLoaded", loadUserPhoto)
  document.addEventListener("turbo:load", loadUserPhoto)
</script>
</div>
