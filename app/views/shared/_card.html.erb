<div class="card-result w-100">
  <!-- Image de fond -->
  <img id="defaultPhoto" src="<%= asset_path('and_the_winner_is.png') %>" alt="photos">

  <!-- Ta photo prise (remplace le fond) -->
  <img id="userPhoto" data-camera-target="cardPhoto" alt="Votre photo">

  <!-- Texte et overlay avec TES STATS -->

  <div class="stats-container d-flex flex-column justify-content-between">

    <!-- affichage des stats -->
    <div class="stats-top mt-1 d-flex justify-content-between align-items-left">
      <h5 class="small">MusixBox ü•ä</h5>
      <h5 class="small text-muted">MusixBox.games</h5>
    </div>

    <% if @fastest_title %>
    <div>
      <h3>Score</h3>
      <div>
        <div>The <%= @playlist.title  %> Playlist: <%= @percentage %>% </div>

      </div>

    <div class="mt-3">
      <h3>Fastest guess</h5>
      <div class="fs-6">
          <% if @fastest_title.song %>
            <%= @fastest_title.song.artist %>- <%= @fastest_title.song.title %>
          <% end %>
          <span class="small">
        <%= (@fastest_title.time_taken / 1000.0).round(2) %>s
          </span>
      </div>
    </div>
    <% end %>


    <% if @percentage> 80 %>
    <div class="rounded-4 py-2 w-100 mx-auto">
      <h3 class="fw-bolder display-8 mb-1">Ace of <%= @playlist.title %> üèÜ</h3>
      <%# Affiche "Perfect score!" seulement si 100% %>
        <% if @percentage==100 %>
          <p class="fw-bold fs-6 mb-0">Perfect score!</p>
          <% end %>
    </div>
    <% end %>

    </div>




  </div>
  <%#============================================%>
    <%# SCRIPT : Charger la photo depuis localStorage %>
      <%#============================================%>
        <script>
          // Fonction qui charge la photo
          function loadUserPhoto() {
            console.log("Script de chargement photo ex√©cut√© !")

            // On r√©cup√®re la photo depuis localStorage
            const savedPhoto = localStorage.getItem("userSelfie")

            console.log("Photo trouv√©e:", savedPhoto ? "OUI" : "NON")

            // On r√©cup√®re les √©l√©ments HTML
            const userPhotoElement = document.getElementById("userPhoto")
            const backgroundImage = document.querySelector(".card-result > img:first-child")

            console.log("Element userPhoto:", userPhotoElement ? "OUI" : "NON")
            console.log("Element background:", backgroundImage ? "OUI" : "NON")

            // Si une photo existe dans localStorage
            if (savedPhoto && userPhotoElement) {

              // On met la photo sauvegard√©e dans l'√©l√©ment <img>
              userPhotoElement.src = savedPhoto

              // On affiche la photo de l'utilisateur
              userPhotoElement.style.display = "block"

              // On cache l'image de fond
              if (backgroundImage) {
                backgroundImage.style.opacity = "0"
              }

              console.log("Photo charg√©e avec succ√®s !")

            } else {
              console.log("Pas de photo ou √©l√©ment non trouv√©")
            }
          }

          // ============================================
          // IMPORTANT : √âcouter les DEUX √©v√©nements
          // ============================================
          // "DOMContentLoaded" = premier chargement de la page
          // "turbo:load" = navigation avec Turbo (Rails 7)

          document.addEventListener("DOMContentLoaded", loadUserPhoto)
          document.addEventListener("turbo:load", loadUserPhoto)
        </script>
</div>